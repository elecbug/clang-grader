# 📘 학생 제출 처리 정책 (정리)

학생이 GitHub URL을 제출했을 때, 제출 형태에 따라 코드를 가져오고 대표 `main` 파일을 결정하는 규칙을 정리합니다.

---

## 1. URL이 **C 파일(blob)** 인 경우

예:

```
https://github.com/user/repo/blob/master/src/assign.c
```

* **대표 main**: 해당 `.c` 파일 ( `.main_filename`에 기록 ).
* **스코프**:

  * 기본: 레포 전체.
  * `--scope dir`: 그 파일의 **부모 디렉토리**만 가져옴.
* **중복 main 처리**:

  * 대표 main 외의 `.c`에서 `main()` 발견 시 무시됨.
  * 충돌 없음.

---

## 2. URL이 **디렉토리(tree)** 인 경우

예:

```
https://github.com/user/repo/tree/master/src/assign1
```

* **대표 main 자동 선택 규칙**:

  1. `path/to/dir/main.c`가 있으면 그것을 대표로.
  2. 없으면 `main()`을 **정확히 1개** 포함한 `.c` 파일.
  3. 위 두 조건을 만족하지 않으면 대표 미결정 → `.main_filename` 없음.
* **스코프**: 해당 디렉토리와 하위 전체.
* **중복 main 처리**:

  * 대표가 결정되면 그 파일만 main으로 취급.
  * 대표가 없으면 모든 `.c`를 대상으로 하며, 다중 `main()` → 컴파일 실패.

---

## 3. URL이 **레포지토리 루트** 인 경우

예:

```
https://github.com/user/repo
```

* **default branch**를 API로 조회.
* 이후 동작은 **2. 디렉토리 URL**과 동일하게 처리 (스코프 = 루트 디렉토리).
* 대표 main 자동 선택 규칙도 동일.

---

## 4. `.main_filename` 파일

* 각 학생 루트 디렉토리에 `.main_filename` 생성.
* 내용: 대표 main의 **상대 경로**.

  * blob URL → 해당 파일 경로.
  * 디렉토리/레포 URL → 규칙에 따라 선택된 main 경로.
  * 대표가 없으면 파일 없음.
* `run.sh` → `run_tests.py`로 전달되어, 대표 main만 포함해서 빌드.

---

## 5. 정책 예외 / 혼동될 수 있는 부분

* 대표 main이 `.c`이면 `main.c`로 복제하지 않음 → **중복 main 방지** 목적.
* 디렉토리/레포 URL에서 **main이 여러 개**면 자동 실패(대표 미결정).
* 디렉토리/레포 URL에서 **main이 전혀 없음**도 자동 실패.
* 필요 시 폴백 정책(예: 무조건 `main.c` 강제 지정)을 추가 가능.

---

## ✅ 요약

| 제출 형태      | 스코프                             | 대표 main 결정                      | 중복 main 시 |
| ---------- | ------------------------------- | ------------------------------- | --------- |
| blob(.c)   | 기본: 전체 / `--scope dir`: 부모 디렉토리 | 해당 파일                           | 무시됨       |
| tree(디렉토리) | 해당 디렉토리 전체                      | `main.c` > 유일 main() 포함 파일 > 실패 | 대표 없으면 실패 |
| repo(루트)   | 레포 루트 전체                        | 동일 규칙 적용                        | 대표 없으면 실패 |